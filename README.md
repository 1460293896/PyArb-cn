PyArb的
概述
该项目旨在为 Uniswap V3 开发一个基于 Python 的套利机器人。该机器人旨在识别并可能利用同一代币对的不同 Uniswap V3 池之间的价格差异。该项目包括用于获取池数据、使用适当的代币小数计算价格以及识别简单和三角套利机会的脚本。

主模块
main.py用作应用程序的主要入口点。它查询链上数据以提取加密货币的流动性和价格信息，评估这些数据是否存在潜在的套利机会，并允许重新分析以确定条件是否发生了变化以提供新的机会。

main_demo

数据转换和处理
该过程首先使用 Web3.py 库建立与以太坊区块链的连接，并设置积极的 gas 价格策略以加快交易确认速度。

然后，它会提示用户以 ETH 和滑点容忍百分比输入所需的交易规模。滑点容错度定义了用户在交易签署和在区块链上执行之间愿意接受的最大价格变动。

流动性和价格数据使用指定的 ABI 和池地址从 Uniswap V3 池合约中检索。 收集每个池地址的流动性，同时获取相应的值，表示 Uniswap V3 使用的价格。get_pool_liquidity_all()get_pool_price_all()sqrtPriceX96

流动性和价格数据都根据给定交易规模和用户的滑点容忍度确定的最小流动性截止值进行过滤。不满足此条件的池将被忽略。

该函数将每个代币对的值转换为人类可读的价格，并调整代币小数点的差异。calculate_price()sqrtPriceX96

每个单向交易都格式化为字典
组装数据后，该文件会生成一个名为 keyed by strings 的字典，每个条目都包含一个元组列表。每个元组都包括代币地址、池地址、费用、流动性和指定代币之间交易的计算价格。pair_pricesTICKER_A_TO_TICKER_B

盈利能力计算
使用字典数据，应用程序计算过滤池对的套利机会。如果一种资产可以在一个市场（池）中以较低的价格买入，并在另一个市场（池）中以更高的价格出售，在考虑交易费用、滑点和燃料成本后，就存在套利机会。pair_prices

该函数计算不同池中每个代币对的缩放买入和卖出价格。它考虑了交易/滑点成本，并使用gas费用（以Wei为单位，转换为ETH）来评估交易的潜在盈利能力。calculate_arbitrage_opportunities()

重新运行功能
该脚本为用户提供了一个选项，无需重新启动程序即可重新运行数据检索和评估过程，只需在函数提示时输入“y”即可。池地址、币种地址和币种小数点已启动并从第一次运行开始保留。用户输入的交易金额和滑点容差也被保留。它获取新的 gas 价格并再次运行智能合约价格查询以寻找新机会。rerun()

其他模块
该项目分为几个 Python 模块，每个模块都有特定的目的：

coins.py：包含一个字典，将代币代码映射到其各自的以太坊合约地址。
decimals.py：使用 Web3 库和 ERC-20 ABI 获取并存储每个令牌的小数点数。decimals
pricing.py：查询 Uniswap V3 矿池合约的流动性和其他矿池特定数据。
arbitrage_simple.py：通过比较不同池中的代币价格来识别简单的套利机会。
arbitrage_triangle.py：通过在代币池的图形表示中查找长度为 3 的周期来识别三角套利机会。
关键概念
池数据：有关每个池的信息，包括代币地址、流动性和池费用。sqrt_price_x96
价格计算：转换为实际代币价格，根据代币小数点进行调整。sqrt_price_x96
图形构造：将令牌池表示为图形，其中节点是令牌，边是具有关联价格的池。
套利识别：考虑交易方向，检测可利用价格差异获利的算法。
用法
环境设置：通过运行 来安装所需的 Python 包，例如 。web3pip install -r requirements.txt

以太坊节点配置：使用您的以太坊节点 HTTP 提供程序 URL 在项目的根目录中创建一个文件。例如：.env

WEB3_PROVIDER_URL="https://mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID"
令牌配置：在 中，通过指定其股票代码和以太坊合约地址来添加您希望机器人监控的令牌。例如：coins.py

# coins.py
coins = {
    "WETH": '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2',
    "WBTC": '0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599',
    "DAI": '0x6B175474E89094C44Da98b954EedeAC495271d0F',
    # Add more tokens as needed
}
Fetch Token Decimals：运行以提取并存储字典中每个令牌的小数位数。这些信息对于准确的价格计算至关重要。decimals.pycoins_decimals

查询池数据：用于查询 Uniswap V3 池的最新数据，包括流动性、价格和费用。pricing.py

识别套利机会：执行以识别同一代币对的不同池中的简单套利机会。或者，通过在代币图中查找盈利周期来识别三角套利机会。arbitrage_simple.pyarbitrage_triangle.py

审查结果：分析潜在套利机会的输出。这些脚本将打印有关盈利交易的信息，包括涉及的代币、执行交易的池以及预期的利润率。

考虑
滑点：该机器人目前不考虑滑点，滑点会显着影响套利交易的盈利能力，尤其是在流动性低的池中。
交易成本：以太坊 gas 费用在当前实施中不考虑，必须计入盈利能力计算。
执行时间：去中心化交易所的价格可能会迅速变化，因此机器人必须快速执行交易以捕捉已识别的机会。
智能合约交互：机器人的生产版本需要智能合约集成才能自动执行交易。
未来工作
实施滑点估计并将其包含在盈利能力计算中。
与以太坊钱包和智能合约集成，实现自动交易执行。
增加对套利机会的实时监控和警报。
优化机器人的性能，提高其对不断变化的市场条件的适应能力。
免責聲明
本项目仅用于教育目的。套利交易存在财务风险，在实时网络上运行任何交易机器人之前，您应该进行自己的尽职调查。本项目的开发人员不对因使用此机器人而产生的任何经济损失负责。
